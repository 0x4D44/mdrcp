# Code Coverage Analysis
**Date:** 2026-01-01
**Tool:** `cargo llvm-cov`

## Overview

The initial coverage run shows a solid baseline for the core logic in `src/lib.rs` and `src/cli/mod.rs`, but reveals significant gaps in error handling, UI output (printing functions), and edge cases (explicit binaries, JSON formatting). `src/main.rs` shows 0% coverage, which is typical if integration tests run the binary as a subprocess without specific instrumentation configuration, or if unit tests target the library interface.

## Detailed Findings

### `src/main.rs` (0% Coverage)
*   **Status:** Completely uncovered.
*   **Reason:** The file is a thin wrapper around `mdrcp::lib`. Integration tests likely execute the built binary or verify the library logic directly.
*   **Action:** Low priority. The logic is delegated.

### `src/cli/mod.rs`
*   **Printing Functions:**
    *   `print_version_banner` (Lines 37-39): Uncovered.
    *   `print_help` (Lines 123-125): Uncovered.
    *   `print_parse_error` (Lines 243-288): Completely uncovered. This is a large chunk of UI logic for error reporting.
*   **Parsing Edge Cases:**
    *   `--target=` with empty value (Lines 192-194).
    *   `--summary=` with empty value (Lines 201-203, 207-208).
    *   `parse_summary_format`: The `"text"` branch (Line 236) is not explicitly hit via the `--summary` flag (likely only default behavior is tested).

### `src/lib.rs`
*   **Utility Methods:**
    *   `ProjectType::label` (Lines 38-43): Uncovered.
    *   `target_dir_override_from_env`: Empty value check (Lines 299-302).
*   **Manifest Parsing:**
    *   `manifest_bin_names`: The loop handling `[[bin]]` entries (Lines 211-221) is uncovered. Tests rely on `package.name`.
*   **Workspace/File Handling:**
    *   `find_built_executables`: Error handling for unreadable/invalid member `Cargo.toml` files (Lines 264, 268, 271) is uncovered.
*   **Tauri Support:**
    *   `read_tauri_product_name`: JSON structure mismatches (missing `productName` inside `package` or root) are partially uncovered.
    *   `run_with_options`:
        *   Printing "Detected Tauri project" (Lines 453-460).
*   **Execution Logic (`run_with_options`):**
    *   **File Copy Failures:** The `Err` branch of `fs::copy` (Lines 488-507) is uncovered.
    *   **Summary Output:**
        *   JSON output generation (Lines 549-579) is largely uncovered.
        *   Warning output when `emit_text` is false (Lines 542-544).
    *   **Failure Reporting:**
        *   The logic that reports failed binaries at the end of the run (Lines 519-530, 582-593) is uncovered.

## Conclusion

To reach 98% coverage, we need to focus on:
1.  **Error Handling:** Triggering `ParseError` display and `fs::copy` failures.
2.  **Output Formats:** Verifying JSON summary output and CLI help/version prints.
3.  **Manifest Complexity:** Testing projects with explicit `[[bin]]` definitions.
